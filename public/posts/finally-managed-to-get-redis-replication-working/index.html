<!doctype html>















































<html
  class="not-ready lg:text-base"
  style="--bg: #faf8f1"
  lang="en-us"
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>Finally Managed to Get Redis Replication Working - Denny Pradipta&#39;s Blog</title>

  
  <meta name="theme-color" />

  
  
  
  
  <meta name="description" content="So I was trying to set up Redis replication with Redis Sentinel. I had this plan involving five servers:
10.10.10.1 - Master 10.10.10.2 - Slave 10.10.10.3, 10.10.10.4, 10.10.10.5 - Sentinels Redis Sentinels are responsible for monitoring the health of the Redis master and slaves. If the master goes down, the sentinel will promote a slave to be the new master. If a slave goes down, the sentinel will promote a new slave to take its place." />
  <meta name="author" content="Denny Pradipta" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="http://localhost:1313/main.min.css" />

  
  
  
  
  
  <link rel="preload" as="image" href="http://localhost:1313/theme.png" />

  
  
  
  
  <link rel="preload" as="image" href="https://www.gravatar.com/avatar/ff5b63b23c720aa45589e3ef304c4936?s=160&amp;d=identicon" />
  
  

  
  
  <link rel="preload" as="image" href="http://localhost:1313/twitter.svg" />
  
  <link rel="preload" as="image" href="http://localhost:1313/github.svg" />
  
  <link rel="preload" as="image" href="http://localhost:1313/linkedin.svg" />
  
  <link rel="preload" as="image" href="http://localhost:1313/rss.svg" />
  
  

  
  
  <script
    defer
    src="http://localhost:1313/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  
  

  
  <link rel="icon" href="http://localhost:1313/favicon.ico" />
  <link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.125.2">

  
  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="http://localhost:1313/"
      >Denny Pradipta&#39;s Blog</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./twitter.svg)"
        href="https://twitter.com/dennypradipta_"
        target="_blank"
        rel="me"
      >
        twitter
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href="https://github.com/dennypradipta"
        target="_blank"
        rel="me"
      >
        github
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./linkedin.svg)"
        href="https://linkedin.com/in/dennypradipta"
        target="_blank"
        rel="me"
      >
        linkedin
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./rss.svg)"
        href="http://localhost:1313/index.xml"
        target="_blank"
        rel="alternate"
      >
        rss
      </a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"
    >
      

<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">Finally Managed to Get Redis Replication Working</h1>

    
    <div class="text-sm antialiased opacity-60">
      
      <time>Oct 11, 2024</time>
      
      
      
      
    </div>
    
  </header>

  <section><p>So I was trying to set up Redis replication with Redis Sentinel. I had this plan involving five servers:</p>
<ul>
<li>10.10.10.1 - Master</li>
<li>10.10.10.2 - Slave</li>
<li>10.10.10.3, 10.10.10.4, 10.10.10.5 - Sentinels</li>
</ul>
<p>Redis Sentinels are responsible for monitoring the health of the Redis master and slaves. If the master goes down, the sentinel will promote a slave to be the new master. If a slave goes down, the sentinel will promote a new slave to take its place.</p>
<p>Here are the Docker Compose files I used to set up the five servers:</p>
<ol>
<li>Master (10.10.10.1)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redis-master</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">bitnami/redis:6.2.6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">unless-stopped</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_REPLICATION_MODE=master</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_PASSWORD=nicely-done</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./data:/bitnami</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">network_mode</span>: <span style="color:#ae81ff">host</span>
</span></span></code></pre></div><ol start="2">
<li>Slave (10.10.10.2)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redis-slave</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">bitnami/redis:6.2.6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">unless-stopped</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_REPLICATION_MODE=slave</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_REPLICA_IP=10.10.10.2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_MASTER_HOST=10.10.10.1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_MASTER_PORT_NUMBER=6379</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_MASTER_PASSWORD=nicely-done</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_PASSWORD=nicely-good</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./data:/bitnami</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">network_mode</span>: <span style="color:#ae81ff">host</span>
</span></span></code></pre></div><ol start="3">
<li>Sentinels (10.10.10.3, 10.10.10.4, 10.10.10.5)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redis-sentinel</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">bitnami/redis-sentinel:6.2.6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">unless-stopped</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">network_mode</span>: <span style="color:#ae81ff">host</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_MASTER_HOST=10.10.10.1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_MASTER_PASSWORD=nicely-done</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_SENTINEL_ANNOUNCE_IP=(10.10.10.3/10.10.10.4/10.10.10.5)</span> <span style="color:#75715e"># According to the Sentinel servers</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_SENTINEL_ANNOUNCE_PORT=26379</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_SENTINEL_DOWN_AFTER_MILLISECONDS=5000</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_SENTINEL_FAILOVER_TIMEOUT=10000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./data:/bitnami</span>
</span></span></code></pre></div><p>When I run the Docker Compose files, everything works as expected. The master and slaves are able to communicate with each other, and the sentinels are able to monitor the health of the master and slaves. Take a look at the logs:</p>
<ol>
<li>Master</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker compose exec -it redis-master redis-cli
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; auth nicely-done
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; info replication
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replication</span>
</span></span><span style="display:flex;"><span>role:master
</span></span><span style="display:flex;"><span>connected_slaves:1
</span></span><span style="display:flex;"><span>slave0:ip<span style="color:#f92672">=</span>10.10.10.2,port<span style="color:#f92672">=</span>6379,state<span style="color:#f92672">=</span>online,offset<span style="color:#f92672">=</span>66939,lag<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:ac7df14482399c324613a0570a22ab91003dc091
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:67213
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1
</span></span><span style="display:flex;"><span>repl_backlog_histlen:67213
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; exit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker compose logs
</span></span><span style="display:flex;"><span>redis-master-1  | redis 04:04:33.36 INFO  <span style="color:#f92672">==</span>&gt; ** Starting Redis setup **
</span></span><span style="display:flex;"><span>redis-master-1  | redis 04:04:33.39 INFO  <span style="color:#f92672">==</span>&gt; Initializing Redis
</span></span><span style="display:flex;"><span>redis-master-1  | redis 04:04:33.41 INFO  <span style="color:#f92672">==</span>&gt; Setting Redis config file
</span></span><span style="display:flex;"><span>redis-master-1  | redis 04:04:33.44 INFO  <span style="color:#f92672">==</span>&gt; Configuring replication mode
</span></span><span style="display:flex;"><span>redis-master-1  | redis 04:04:33.47 INFO  <span style="color:#f92672">==</span>&gt; ** Redis setup finished! **
</span></span><span style="display:flex;"><span>redis-master-1  |
</span></span><span style="display:flex;"><span>redis-master-1  | redis 04:04:33.50 INFO  <span style="color:#f92672">==</span>&gt; ** Starting Redis **
</span></span><span style="display:flex;"><span>redis-master-1  | 1:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.513 <span style="color:#75715e"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
</span></span><span style="display:flex;"><span>redis-master-1  | 1:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.513 <span style="color:#75715e"># Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=1, just started</span>
</span></span><span style="display:flex;"><span>redis-master-1  | 1:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.513 <span style="color:#75715e"># Configuration loaded</span>
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.514 * monotonic clock: POSIX clock_gettime
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.514 * Running mode<span style="color:#f92672">=</span>standalone, port<span style="color:#f92672">=</span>6379.
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.514 <span style="color:#75715e"># Server initialized</span>
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.514 <span style="color:#75715e"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span>
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.515 * Ready to accept connections
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.905 * Replica 10.10.10.2:6379 asks <span style="color:#66d9ef">for</span> synchronization
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.905 * Partial resynchronization not accepted: Replication ID mismatch <span style="color:#f92672">(</span>Replica asked <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;fde979edfc5ededf1fd236e09932470573bd7d98&#39;</span>, my replication IDs are <span style="color:#e6db74">&#39;873211e79d2539472cbf037cd01eec05e9e10e36&#39;</span> and <span style="color:#e6db74">&#39;0000000000000000000000000000000000000000&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.905 * Replication backlog created, my new replication IDs are <span style="color:#e6db74">&#39;c19e2aa59d310f3c377aa34cdefe02722621a87b&#39;</span> and <span style="color:#e6db74">&#39;0000000000000000000000000000000000000000&#39;</span>
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.905 * Starting BGSAVE <span style="color:#66d9ef">for</span> SYNC with target: disk
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.905 * Background saving started by pid <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>redis-master-1  | 50:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.908 * DB saved on disk
</span></span><span style="display:flex;"><span>redis-master-1  | 50:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.909 * RDB: <span style="color:#ae81ff">0</span> MB of memory used by copy-on-write
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.917 * Background saving terminated with success
</span></span><span style="display:flex;"><span>redis-master-1  | 1:M <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:33.917 * Synchronization with replica 10.10.10.2:6379 succeeded
</span></span></code></pre></div><ol start="2">
<li>Slave</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker compose exec -it redis-replica redis-cli
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; auth nicely-good
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; info replication
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replication</span>
</span></span><span style="display:flex;"><span>role:slave
</span></span><span style="display:flex;"><span>master_host:10.10.10.1
</span></span><span style="display:flex;"><span>master_port:6379
</span></span><span style="display:flex;"><span>master_link_status:up
</span></span><span style="display:flex;"><span>master_last_io_seconds_ago:0
</span></span><span style="display:flex;"><span>master_sync_in_progress:0
</span></span><span style="display:flex;"><span>slave_read_repl_offset:76462
</span></span><span style="display:flex;"><span>slave_repl_offset:76462
</span></span><span style="display:flex;"><span>slave_priority:100
</span></span><span style="display:flex;"><span>slave_read_only:1
</span></span><span style="display:flex;"><span>replica_announced:1
</span></span><span style="display:flex;"><span>connected_slaves:0
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:ac7df14482399c324613a0570a22ab91003dc091
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:76462
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:3737
</span></span><span style="display:flex;"><span>repl_backlog_histlen:72726
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; exit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker compose logs
</span></span><span style="display:flex;"><span>redis-replica-1  | redis 04:19:52.07 INFO  <span style="color:#f92672">==</span>&gt; ** Starting Redis setup **
</span></span><span style="display:flex;"><span>redis-replica-1  | redis 04:19:52.10 INFO  <span style="color:#f92672">==</span>&gt; Initializing Redis
</span></span><span style="display:flex;"><span>redis-replica-1  | redis 04:19:52.12 INFO  <span style="color:#f92672">==</span>&gt; Setting Redis config file
</span></span><span style="display:flex;"><span>redis-replica-1  | redis 04:19:52.14 INFO  <span style="color:#f92672">==</span>&gt; Configuring replication mode
</span></span><span style="display:flex;"><span>redis-replica-1  | redis 04:19:52.19 INFO  <span style="color:#f92672">==</span>&gt; ** Redis setup finished! **
</span></span><span style="display:flex;"><span>redis-replica-1  |
</span></span><span style="display:flex;"><span>redis-replica-1  | redis 04:19:52.21 INFO  <span style="color:#f92672">==</span>&gt; ** Starting Redis **
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.228 <span style="color:#75715e"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.228 <span style="color:#75715e"># Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=1, just started</span>
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.228 <span style="color:#75715e"># Configuration loaded</span>
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.229 * monotonic clock: POSIX clock_gettime
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.230 * Running mode<span style="color:#f92672">=</span>standalone, port<span style="color:#f92672">=</span>6379.
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.230 <span style="color:#75715e"># Server initialized</span>
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.230 <span style="color:#75715e"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span>
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 * Reading RDB preamble from AOF file...
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 * Loading RDB produced by version 6.2.6
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 * RDB age <span style="color:#ae81ff">919</span> seconds
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 * RDB memory usage when created 1.79 Mb
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 * RDB has an AOF tail
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 <span style="color:#75715e"># Done loading RDB, keys loaded: 0, keys expired: 0.</span>
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 * Reading the remaining AOF tail...
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 * DB loaded from append only file: 0.000 seconds
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 * Ready to accept connections
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 * Connecting to MASTER 10.10.10.1:6379
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.231 * MASTER &lt;-&gt; REPLICA sync started
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.232 * Non blocking connect <span style="color:#66d9ef">for</span> SYNC fired the event.
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.232 * Master replied to PING, replication can <span style="color:#66d9ef">continue</span>...
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.232 * Partial resynchronization not possible <span style="color:#f92672">(</span>no cached master<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.233 * Full resync from master: c19e2aa59d310f3c377aa34cdefe02722621a87b:1274
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.337 * MASTER &lt;-&gt; REPLICA sync: receiving <span style="color:#ae81ff">176</span> bytes from master to disk
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.337 * MASTER &lt;-&gt; REPLICA sync: Flushing old data
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.337 * MASTER &lt;-&gt; REPLICA sync: Loading DB in memory
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.340 * Loading RDB produced by version 6.2.6
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.340 * RDB age <span style="color:#ae81ff">0</span> seconds
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.340 * RDB memory usage when created 1.83 Mb
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.340 <span style="color:#75715e"># Done loading RDB, keys loaded: 0, keys expired: 0.</span>
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.340 * MASTER &lt;-&gt; REPLICA sync: Finished with success
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.340 * Background append only file rewriting started by pid <span style="color:#ae81ff">54</span>
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.364 * AOF rewrite child asks to stop sending diffs.
</span></span><span style="display:flex;"><span>redis-replica-1  | 54:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.364 * Parent agreed to stop sending diffs. Finalizing AOF...
</span></span><span style="display:flex;"><span>redis-replica-1  | 54:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.364 * Concatenating 0.00 MB of AOF diff received from parent.
</span></span><span style="display:flex;"><span>redis-replica-1  | 54:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.364 * SYNC append only file rewrite performed
</span></span><span style="display:flex;"><span>redis-replica-1  | 54:C <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.365 * AOF rewrite: <span style="color:#ae81ff">0</span> MB of memory used by copy-on-write
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.433 * Background AOF rewrite terminated with success
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.433 * Residual parent diff successfully flushed to the rewritten AOF <span style="color:#f92672">(</span>0.00 MB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>redis-replica-1  | 1:S <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:19:52.433 * Background AOF rewrite finished successfully
</span></span></code></pre></div><h2 id="the-problem">The Problem</h2>
<p>However, I noticed that the failover process is not working as expected. I tried to turn off the master, but it won&rsquo;t promote the slave to be the master. When I turn off the master, I observe the logs of the Sentinels:</p>
<ol>
<li>Sentinel 1 (10.10.10.3)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.66
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.67 INFO  <span style="color:#f92672">==</span>&gt; ** Starting Redis sentinel setup **
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.70 INFO  <span style="color:#f92672">==</span>&gt; Initializing Redis Sentinel...
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.70 INFO  <span style="color:#f92672">==</span>&gt; Persisted files detected, restoring...
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.71 INFO  <span style="color:#f92672">==</span>&gt; ** Redis sentinel setup finished! **
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.73 INFO  <span style="color:#f92672">==</span>&gt; ** Starting Redis Sentinel **
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:09.426 <span style="color:#75715e"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:09.426 <span style="color:#75715e"># Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=1, just started</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:09.426 <span style="color:#75715e"># Configuration loaded</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:09.427 * monotonic clock: POSIX clock_gettime
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:09.428 * Running mode<span style="color:#f92672">=</span>sentinel, port<span style="color:#f92672">=</span>26379.
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:09.429 <span style="color:#75715e"># Sentinel ID is cfc415ecf2999a460cfb68bb685b92865c77140e</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:09.429 <span style="color:#75715e"># +monitor master mymaster 10.10.10.1 6379 quorum 2</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:14.447 <span style="color:#75715e"># +sdown slave 10.10.10.2:6379 10.10.10.2 6379 @ mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:14.447 <span style="color:#75715e"># +sdown sentinel 7f4d7e6f21bdc085b182f3c122809a0c1e0c2726 10.10.10.5 26379 @ mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:14.751 <span style="color:#75715e"># -sdown sentinel 7f4d7e6f21bdc085b182f3c122809a0c1e0c2726 10.10.10.5 26379 @ mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.719 <span style="color:#75715e"># +sdown master mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.835 <span style="color:#75715e"># +new-epoch 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.839 <span style="color:#75715e"># +vote-for-leader 9385b6cd08afe315e2c012e335585867da43ef2d 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:25.845 <span style="color:#75715e"># +odown master mymaster 10.10.10.1 6379 #quorum 3/2</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:25.845 <span style="color:#75715e"># Next failover delay: I will not start a failover before Fri Oct 11 04:04:45 2024</span>
</span></span></code></pre></div><ol start="2">
<li>Sentinel 2 (10.10.10.4)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.66
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.67 INFO  <span style="color:#f92672">==</span>&gt; ** Starting Redis sentinel setup **
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.70 INFO  <span style="color:#f92672">==</span>&gt; Initializing Redis Sentinel...
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.70 INFO  <span style="color:#f92672">==</span>&gt; Persisted files detected, restoring...
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.71 INFO  <span style="color:#f92672">==</span>&gt; ** Redis sentinel setup finished! **
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.73 INFO  <span style="color:#f92672">==</span>&gt; ** Starting Redis Sentinel **
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:12.128 <span style="color:#75715e"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:12.128 <span style="color:#75715e"># Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=1, just started</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:12.128 <span style="color:#75715e"># Configuration loaded</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:12.129 * monotonic clock: POSIX clock_gettime
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:12.130 * Running mode<span style="color:#f92672">=</span>sentinel, port<span style="color:#f92672">=</span>26379.
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:12.130 <span style="color:#75715e"># Sentinel ID is 9385b6cd08afe315e2c012e335585867da43ef2d</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:12.130 <span style="color:#75715e"># +monitor master mymaster 10.10.10.1 6379 quorum 2</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:17.172 <span style="color:#75715e"># +sdown slave 10.10.10.2:6379 10.10.10.2 6379 @ mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.719 <span style="color:#75715e"># +sdown master mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.810 <span style="color:#75715e"># +odown master mymaster 10.10.10.1 6379 #quorum 2/2</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.810 <span style="color:#75715e"># +new-epoch 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.810 <span style="color:#75715e"># +try-failover master mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.814 <span style="color:#75715e"># +vote-for-leader 9385b6cd08afe315e2c012e335585867da43ef2d 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.823 <span style="color:#75715e"># cfc415ecf2999a460cfb68bb685b92865c77140e voted for 9385b6cd08afe315e2c012e335585867da43ef2d 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.823 <span style="color:#75715e"># 7f4d7e6f21bdc085b182f3c122809a0c1e0c2726 voted for 9385b6cd08afe315e2c012e335585867da43ef2d 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.915 <span style="color:#75715e"># +elected-leader master mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.915 <span style="color:#75715e"># +failover-state-select-slave master mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.978 <span style="color:#75715e"># -failover-abort-no-good-slave master mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:25.031 <span style="color:#75715e"># Next failover delay: I will not start a failover before Fri Oct 11 04:04:45 2024</span>
</span></span></code></pre></div><ol start="3">
<li>Sentinel 3 (10.10.10.5)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.66
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.67 INFO  <span style="color:#f92672">==</span>&gt; ** Starting Redis sentinel setup **
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.70 INFO  <span style="color:#f92672">==</span>&gt; Initializing Redis Sentinel...
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.70 INFO  <span style="color:#f92672">==</span>&gt; Persisted files detected, restoring...
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.71 INFO  <span style="color:#f92672">==</span>&gt; ** Redis sentinel setup finished! **
</span></span><span style="display:flex;"><span>redis-sentinel-1  | redis-sentinel 04:01:28.73 INFO  <span style="color:#f92672">==</span>&gt; ** Starting Redis Sentinel **
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:14.557 <span style="color:#75715e"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:14.557 <span style="color:#75715e"># Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=1, just started</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:14.557 <span style="color:#75715e"># Configuration loaded</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:14.558 * monotonic clock: POSIX clock_gettime
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:14.559 * Running mode<span style="color:#f92672">=</span>sentinel, port<span style="color:#f92672">=</span>26379.
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:14.559 <span style="color:#75715e"># Sentinel ID is 7f4d7e6f21bdc085b182f3c122809a0c1e0c2726</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:14.559 <span style="color:#75715e"># +monitor master mymaster 10.10.10.1 6379 quorum 2</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:19.605 <span style="color:#75715e"># +sdown slave 10.10.10.2:6379 10.10.10.2 6379 @ mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.726 <span style="color:#75715e"># +sdown master mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.813 <span style="color:#75715e"># +new-epoch 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.817 <span style="color:#75715e"># +vote-for-leader 9385b6cd08afe315e2c012e335585867da43ef2d 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.827 <span style="color:#75715e"># +odown master mymaster 10.10.10.1 6379 #quorum 3/2</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.827 <span style="color:#75715e"># Next failover delay: I will not start a failover before Fri Oct 11 04:04:45 2024</span>
</span></span></code></pre></div><p>Pay attention to this logs from Sentinel 2:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.810 <span style="color:#75715e"># +try-failover master mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.814 <span style="color:#75715e"># +vote-for-leader 9385b6cd08afe315e2c012e335585867da43ef2d 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.823 <span style="color:#75715e"># cfc415ecf2999a460cfb68bb685b92865c77140e voted for 9385b6cd08afe315e2c012e335585867da43ef2d 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.823 <span style="color:#75715e"># 7f4d7e6f21bdc085b182f3c122809a0c1e0c2726 voted for 9385b6cd08afe315e2c012e335585867da43ef2d 38</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.915 <span style="color:#75715e"># +elected-leader master mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.915 <span style="color:#75715e"># +failover-state-select-slave master mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 1:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 04:04:24.978 <span style="color:#75715e"># -failover-abort-no-good-slave master mymaster 10.10.10.1 6379</span>
</span></span></code></pre></div><p>It says that the failover was aborted because there was no good slave. The hell do you mean &ldquo;no good slave&rdquo;? I mean, the slave is up and running without any issues but it won&rsquo;t be promoted to be the master.</p>
<h2 id="the-solution">The Solution</h2>
<p>After digging StackOverflow, Gogole, Bitnami repos, and whatnot, I found the solution. Turns out, you need to have the same password for the master and the slave. I wasn&rsquo;t using the same password for the master and the slave (nicely-done and nicely-good), so when the sentinels tried to promote the slave to be the master, it failed because the passwords didn&rsquo;t match.</p>
<p>Here&rsquo;s a simplified flow for you to understand what would happen if the passwords is not the ssame:</p>
<ol>
<li>Everything is running as usual</li>
<li>I turned off the master</li>
<li>&ldquo;Oh damn, master is down. Reelect the primary now!&rdquo; - Sentinel</li>
<li>Searching for a new master from a list of available replicas</li>
<li>&ldquo;Found it. Let&rsquo;s use this replica. Oh, it needs auth, the master password is nicely-done according to our configuration&rdquo; - Sentinel</li>
<li>Proceed to auth using nicely-done</li>
<li>Unauthorized because the replica password is nicely-good</li>
<li>&ldquo;Oh damn, we are not allowed. Oh well, back to the original master&rdquo; - Sentinel</li>
</ol>
<p>So I changed the passwords for the master and the slave. Now here&rsquo;s a simplified flow if the passwords is the same:</p>
<ol>
<li>Everything is running as usual</li>
<li>Turn off the master</li>
<li>&ldquo;Oh damn, master is down. Reelect the primary now!&rdquo; - Sentinel</li>
<li>Searching for a new master from a list of available replicas</li>
<li>&ldquo;Found it. Let&rsquo;s use this replica. Oh, it needs auth, the master password is nicely-done according to our configuration&rdquo; - Sentinel</li>
<li>Proceed to auth using nicely-done</li>
<li>Authorized</li>
</ol>
<p>And that&rsquo;s it. The failover process is now working as expected. The logs of the sentinels tells me that the switch was successful:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>redis-sentinel-1  | 9:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 08:01:28.126 <span style="color:#75715e"># +config-update-from sentinel f704a040c0f05d0e00e1697642f4bd8f09548432 10.10.10.3 26379 @ mymaster 10.10.10.1 6379</span>
</span></span><span style="display:flex;"><span>redis-sentinel-1  | 9:X <span style="color:#ae81ff">11</span> Oct <span style="color:#ae81ff">2024</span> 08:01:28.126 <span style="color:#75715e"># +switch-master mymaster 10.10.10.1 6379 10.10.10.2 6379</span>
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>This is the first time I have implemented a Redis replication. I spent two days trying to figure out why the failover wasnt working, and guess what? It all boiled down to having different passwords for the master and the replica. Redis requires both to use the same password for the failover process to work properly. Once I fixed that, everything started working perfectly.</p>
<p>Lesson learned: <strong>Always use the same password for your master and slave Redis instances if you want failover to happen smoothly.</strong></p>
<p>And remember, if all else fails, theres always coffee. Lots of coffee.</p>
</section>

  
  

  
  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="http://localhost:1313/posts/so-thats-how-you-do-mongodb-replication/"
      ><span>So That&#39;s How You Do MongoDB Replication!</span><span class="ml-1.5"></span></a
    >
    
  </nav>
  
  

  
  

  
  

  


  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2024
    <a class="link" href="http://localhost:1313/">Denny Pradipta&#39;s Blog</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by Hugo</a
  >
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    > Paper</a
  >
</footer>

  </body>
</html>
